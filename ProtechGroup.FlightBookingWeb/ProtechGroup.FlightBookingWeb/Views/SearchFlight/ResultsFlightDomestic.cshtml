@model ProtechGroup.Domain.FlightResultOutput
@{
    var searchInput = (ProtechGroup.Domain.Entities.SearchInputMod)ViewBag.SearchInput;
    ViewBag.Title = "Kết quả tìm kiếm chuyến bay";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@functions {
    public static string FormatVietnameseDate(DateTime date)
    {
        int dayOfWeek = (int)date.DayOfWeek;
        string thu;

        switch (dayOfWeek)
        {
            case 0: thu = "Chủ nhật"; break;
            case 1: thu = "Thứ 2"; break;
            case 2: thu = "Thứ 3"; break;
            case 3: thu = "Thứ 4"; break;
            case 4: thu = "Thứ 5"; break;
            case 5: thu = "Thứ 6"; break;
            case 6: thu = "Thứ 7"; break;
            default: thu = ""; break;
        }

        return $"{thu} - {date:dd/MM}";
    }
}
@Html.AntiForgeryToken()
<div id="loading" style="display:flex; justify-content:center; align-items:center; height:300px;">
    <img src="~/Content/img/search_loading.gif" alt="Đang tìm chuyến bay..." style="width: 100px; height: 100px;">
</div>

@Html.Partial("_FrmSearchAirports")
<main class="flight-list" id="flight-list" style="display:none;">
    <div class="heading">
        <div class="container">
            <div class="row">
                <div>
                    <h1 class="color-dark">DANH SÁCH CHUYẾN BAY</h1>
                    <p class="color-primary">
                        Giá vé chưa bao gồm thuế và các loại thuế khác, khách hàng lưu ý
                        chọn chi tiết để xem đầy đủ.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="session">
        <div class="container">
            <div class="row">
                <div class="col-3">
                    <div id="ModalFilter" class="modal">
                        <div class="modal-content">
                            <div class="filter">
                                <div class="heading">
                                    <p class="color-dark">Bộ lọc chiều đi</p>
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 6V4M12 6C10.8954 6 10 6.89543 10 8C10 9.10457 10.8954 10 12 10M12 6C13.1046 6 14 6.89543 14 8C14 9.10457 13.1046 10 12 10M6 18C7.10457 18 8 17.1046 8 16C8 14.8954 7.10457 14 6 14M6 18C4.89543 18 4 17.1046 4 16C4 14.8954 4.89543 14 6 14M6 18V20M6 14V4M12 10V20M18 18C19.1046 18 20 17.1046 20 16C20 14.8954 19.1046 14 18 14M18 18C16.8954 18 16 17.1046 16 16C16 14.8954 16.8954 14 18 14M18 18V20M18 14V4"
                                              stroke="#0A7C79" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                </div>
                                <div class="box-filter" id="box-filter-sx">
                                    <div class="heading">
                                        <p class="color-primary">Sắp xếp</p>
                                        <svg width="15" height="10" viewBox="0 0 15 10" fill="none"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path d="M14.1426 1.5L7.64258 8.5L1.14258 1.5" stroke="#0A7C79" stroke-width="1.5"
                                                  stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                    <div class="filter-content">
                                        <label class="color-dark">
                                            <input type="checkbox" value="price" />
                                            Giá (Từ thấp đến cao)
                                        </label>
                                        <label class="color-dark">
                                            <input type="checkbox" value="time" />
                                            Giờ cất cánh (Sớm đến muộn)
                                        </label>
                                    </div>
                                </div>
                                <div class="box-filter" id="box-filter-lth">
                                    <div class="heading">
                                        <p class="color-primary">Lọc Hãng hàng không</p>
                                        <svg width="15" height="10" viewBox="0 0 15 10" fill="none"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path d="M14.1426 1.5L7.64258 8.5L1.14258 1.5" stroke="#0A7C79" stroke-width="1.5"
                                                  stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                    <div class="filter-content">
                                        @foreach (var airline in Model.Airlines)
                                        {
                                            <label class="color-dark">
                                                <input type="checkbox" value="@airline.AirlineCode" />
                                                <div>
                                                    <span>@airline.AirlineName</span>
                                                    <img src="/Content/img/Airline/sm@(airline.AirlineCode + ".gif")" alt="logo" />
                                                </div>
                                            </label>
                                        }
                                    </div>
                                </div>
                                <div class="box-filter" id="box-filter-time">
                                    <div class="heading">
                                        <p class="color-primary">Giờ cất cánh chiều đi</p>
                                        <svg width="15" height="10" viewBox="0 0 15 10" fill="none"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path d="M14.1426 1.5L7.64258 8.5L1.14258 1.5" stroke="#0A7C79" stroke-width="1.5"
                                                  stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                    <div class="filter-content">
                                        <label class="color-dark">
                                            <input type="checkbox" />
                                            <div>
                                                <span>Cả ngày</span>
                                                <span class="time">00:00 - 24:00</span>
                                            </div>
                                        </label>
                                        <label class="color-dark">
                                            <input type="checkbox" />
                                            <div>
                                                <span>Buổi sớm</span>
                                                <span class="time">00:00 - 06:00</span>
                                            </div>
                                        </label>
                                        <label class="color-dark">
                                            <input type="checkbox" />
                                            <div>
                                                <span>Buổi sáng</span>
                                                <span class="time">06:00 - 12:00</span>
                                            </div>
                                        </label>
                                        <label class="color-dark">
                                            <input type="checkbox" />
                                            <div>
                                                <span>Buổi chiều</span>
                                                <span class="time">12:00 - 18:00</span>
                                            </div>
                                        </label>
                                        <label class="color-dark">
                                            <input type="checkbox" />
                                            <div>
                                                <span>Buổi tối</span>
                                                <span class="time">18:00 - 24:00</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-9 col-xxl-12">
                    @if (searchInput.IsRoundTrip)
                    {
                        <div class="is-deposited" style="display: none;">
                            <div class="row row-out-bound"></div>
                            <div class="row row-last-child row-in-bound"></div>
                        </div>
                    }
                    <div class="is-placing item-out-bound">
                        <div class="row">
                            <div class="col-3">
                                <p class="color-info">CHIỀU ĐI </p>
                                <p class="color-dark">NGÀY @(searchInput.DepartureDate.ToString("dd/MM/yyyy"))</p>
                            </div>
                            <div class="col-7">
                                <p class="color-info">@searchInput.DepartureCity (@searchInput.DepartureAirport) -> @searchInput.ArrivalCity (@searchInput.ArrivalAirport)</p>
                                <p class="color-dark">
                                    @if (searchInput.AdultNumber > 0)
                                    {
                                        @(searchInput.AdultNumber + " NGƯỜI LỚN")
                                    }
                                    @if (searchInput.ChildNumber > 0)
                                    {
                                        @(" | " + searchInput.ChildNumber + " TRẺ EM")
                                    }
                                    @if (searchInput.InfantNumber > 0)
                                    {
                                        @(" | " + searchInput.ChildNumber + " EM BÉ")
                                    }
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="list-ticket item-out-bound">
                        <div class="list-action">
                            @{
                                DateTime dateOut = searchInput.DepartureDate;
                                double totalDays = (dateOut - Convert.ToDateTime(DateTime.Now.ToString("dd/MM/yyyy"))).TotalDays;
                                DateTime staDateShow;
                                if (totalDays <= 0)
                                {
                                    staDateShow = dateOut;
                                }
                                else
                                {

                                    if (totalDays <= 3)
                                    {
                                        staDateShow = dateOut.AddDays(-totalDays);
                                    }
                                    else
                                    {
                                        staDateShow = dateOut.AddDays(-3);
                                    }

                                }
                                for (int i = 0; i < 7; i++)
                                {
                                    DateTime dateShow = staDateShow.AddDays(i);
                                    double dayscheck = (dateOut - dateShow).TotalDays;
                                    <div class="action-item" data-session="@searchInput.SessionId" data-strdate="@dateShow.ToString("dd/MM/yyyy")" data-waytype=0>
                                        <div class="date @(dayscheck == 0? Html.Raw("active") : Html.Raw(string.Empty))">
                                            <span class="color-primary">@ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(dateShow.DayOfWeek)</span>
                                            <span class="color-dark">@dateShow.ToString("dd/MM/yyyy")</span>
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                        <div id="openModelFilter" class="d-none d-block-xxl">
                            <p class="color-dark">Bộ lọc</p>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 6V4M12 6C10.8954 6 10 6.89543 10 8C10 9.10457 10.8954 10 12 10M12 6C13.1046 6 14 6.89543 14 8C14 9.10457 13.1046 10 12 10M6 18C7.10457 18 8 17.1046 8 16C8 14.8954 7.10457 14 6 14M6 18C4.89543 18 4 17.1046 4 16C4 14.8954 4.89543 14 6 14M6 18V20M6 14V4M12 10V20M18 18C19.1046 18 20 17.1046 20 16C20 14.8954 19.1046 14 18 14M18 18C16.8954 18 16 17.1046 16 16C16 14.8954 16.8954 14 18 14M18 18V20M18 14V4"
                                      stroke="#0A7C79" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </div>
                        <div class="list-ticket-items list-ticket-items-out">
                            <div class="cheapest">
                                @foreach (var flight in Model.BlockItems[0].FlightOutBounds)
                                {
                                    if (flight.PriceBreakDowns != null && flight.PriceBreakDowns.Count > 0)
                                    {
                                        <div class="item-ticket item-ticket-out" data-codeairline="@flight.MainAirlineCode" data-session="@searchInput.SessionId" data-keybooking="@flight.BookingKey" data-way="OutBound" style="display: block;">
                                            <div class="col-12 d-none d-block-lg">
                                                <div class="btn-detail mobile">
                                                    <button class="color-dark toggle-info" data-target="#@flight.MainFlightNumber">
                                                        Chi tiết hạng vé
                                                        <svg width="8" height="13" viewBox="0 0 8 13" fill="none"
                                                             xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M1.5 1.5L6.5 6.5L1.5 11.5" stroke="#FF3C13" stroke-width="1.5"
                                                                  stroke-linecap="round" stroke-linejoin="round"></path>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="row g-lg-2">
                                                <div class="col-3 d-none-lg">
                                                    <div class="airline-info ">
                                                        <img class="img-logo-airline" src="/Content/img/Airline/sm@(flight.MainAirlineCode + ".gif")" alt="@flight.MainAirlineName">
                                                        <div class="airline-name">
                                                            <span class="color-dark name">@flight.MainAirlineName</span>
                                                            <span class="color-info code">@flight.MainFlightNumber - @flight.Plane</span>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col-5 col-lg-7">
                                                    <div class="flight-details">
                                                        <div class="time-info">
                                                            <div class="departure">
                                                                <div class="time">@flight.MainDepartureTime</div>
                                                                <div class="location">@flight.MainDepartureAirportCode</div>
                                                                @{
                                                                    var dateOfWeekDep = flight.MainDepartureDate.DayOfWeek;
                                                                    string strDateOfWeekDep = ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(dateOfWeekDep);
                                                                    <div class="date d-none-lg">@strDateOfWeekDep - @flight.MainDepartureDate.ToString("dd/MM")</div>
                                                                }
                                                            </div>
                                                            <div class="arrow-item">
                                                                <p class="color-dark duration">@flight.Duration</p>
                                                                <div class="arrow">
                                                                    <span class="d-none-lg">---</span> ✈ <span class="d-none-lg">---</span>
                                                                </div>
                                                                @if (flight.Stop < 1)
                                                                {
                                                                    <p class="color-dark numstop">Bay thẳng</p>
                                                                }
                                                                else
                                                                {
                                                                    <p class="color-dark numstop">@flight.Stop điểm dừng</p>
                                                                }
                                                            </div>
                                                            <div class="arrival">
                                                                <div class="time">@flight.MainArrivalTime</div>
                                                                <div class="location">@flight.MainArrivalAirportCode</div>
                                                                @{
                                                                    var dateOfWeekArr = flight.MainArrivalDate.DayOfWeek;
                                                                    string strDateOfWeekArr = ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(dateOfWeekArr);
                                                                    <div class="date d-none-lg">@strDateOfWeekArr - @flight.MainArrivalDate.ToString("dd/MM")</div>
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                @{
                                                    var clTicketDefault = flight.PriceBreakDowns[0];
                                                    <div class="col-2 d-none-lg">
                                                        <div class="flight-meta">
                                                            <div>
                                                                <p class="color-info">Hạng vé</p>
                                                                <p class="color-dark typeRender">@clTicketDefault.ClassName</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-2 col-lg-5">
                                                        <div class="info-price">
                                                            <span class="color-info price">@ProtechGroup.Application.Common.CoreUtils.FormatPrice(clTicketDefault.TotallPriceAdt) đ</span>
                                                            <div class="color-primary info">
                                                                Giá cho 1 người lớn
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-3  d-none-lg">
                                                        <div class="btn-detail">
                                                            <button class="color-dark toggle-info" data-target="#@flight.MainFlightNumber">
                                                                Chi tiết hạng vé
                                                                <svg width="8" height="13" viewBox="0 0 8 13" fill="none"
                                                                     xmlns="http://www.w3.org/2000/svg">
                                                                    <path d="M1.5 1.5L6.5 6.5L1.5 11.5" stroke="#FF3C13" stroke-width="1.5"
                                                                          stroke-linecap="round" stroke-linejoin="round"></path>
                                                                </svg>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="col-5  d-none-lg">
                                                        <div class="extras">
                                                            <div class="item">
                                                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                                                     xmlns="http://www.w3.org/2000/svg">
                                                                    <path d="M17.5 11.046C15.1839 11.9836 12.6523 12.4998 10 12.4998C7.34775 12.4998 4.81608 11.9836 2.5 11.046M13.3333 4.99984V3.33317C13.3333 2.4127 12.5871 1.6665 11.6667 1.6665H8.33333C7.41286 1.6665 6.66667 2.4127 6.66667 3.33317V4.99984M10 9.99984H10.0083M4.16667 16.6665H15.8333C16.7538 16.6665 17.5 15.9203 17.5 14.9998V6.6665C17.5 5.74603 16.7538 4.99984 15.8333 4.99984H4.16667C3.24619 4.99984 2.5 5.74603 2.5 6.6665V14.9998C2.5 15.9203 3.24619 16.6665 4.16667 16.6665Z"
                                                                          stroke="#FF3C13" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                                    </path>
                                                                </svg>
                                                                <p class="color-info">@clTicketDefault.RecommendationNumber</p>
                                                            </div>
                                                            <div class="item">
                                                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                                                     xmlns="http://www.w3.org/2000/svg">
                                                                    <path d="M10 6.66667V17.5M10 6.66667C10 6.66667 10 5.42269 10 5C10 4.07953 10.7462 3.33333 11.6667 3.33333C12.5871 3.33333 13.3333 4.07953 13.3333 5C13.3333 5.92047 12.5871 6.66667 11.6667 6.66667C11.1689 6.66667 10 6.66667 10 6.66667ZM10 6.66667C10 6.66667 10 5.05243 10 4.58333C10 3.43274 9.06726 2.5 7.91667 2.5C6.76607 2.5 5.83333 3.43274 5.83333 4.58333C5.83333 5.73393 6.76607 6.66667 7.91667 6.66667C8.59817 6.66667 10 6.66667 10 6.66667ZM4.16667 10H15.8333M4.16667 10C3.24619 10 2.5 9.25381 2.5 8.33333C2.5 7.41286 3.24619 6.66667 4.16667 6.66667H15.8333C16.7538 6.66667 17.5 7.41286 17.5 8.33333C17.5 9.25381 16.7538 10 15.8333 10M4.16667 10L4.16667 15.8333C4.16667 16.7538 4.91286 17.5 5.83333 17.5H14.1667C15.0871 17.5 15.8333 16.7538 15.8333 15.8333V10"
                                                                          stroke="#FF3C13" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                                    </path>
                                                                </svg>
                                                                <p class="color-info">@clTicketDefault.AllowanceBaggage</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }
                                                <div class="col-1 ">
                                                    <div class="change-seat d-none">
                                                        <select name="" id="">
                                                            <option value="">Đổi hạng vé</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="line-decor col-12 d-none  d-block-lg"></div>
                                                <div class="col-3 col-lg-6 col-md-8  d-none d-block-lg">
                                                    <div class="airline-info-mobile row-cols-lg-2">
                                                        <img src="/Content/img/Airline/sm@(flight.MainAirlineCode + ".gif")" alt="@flight.MainAirlineName">
                                                        <div class="airline-name">
                                                            <span class="color-dark name">@flight.MainAirlineName</span>
                                                            <span class="color-info code">@flight.FlightRef</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-3 col-lg-6 col-md-4">
                                                    @if (!searchInput.IsRoundTrip)
                                                    {
                                                        <div class="btn-booking">
                                                            <a class="btn btn-info btn-order-oneway">ĐẶT VÉ</a>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="btn-booking">
                                                            <a class="btn btn-info btn-select-round-trip">CHỌN</a>
                                                        </div>
                                                    }
                                                </div>

                                                <div class="info-ticket color-primary" id="@flight.MainFlightNumber">
                                                    <div class="ticket-types">
                                                        <div class="row row-cols-12 row-cols-md-3  g-md-1">
                                                            @foreach (var price in flight.PriceBreakDowns)
                                                            {
                                                                <div class="col">
                                                                    <input hidden="" type="radio" class="inputChangeType" id="@(flight.MainAirlineCode + flight.FlightRef + "-" + price.FareClass)" name="type_@(flight.MainAirlineCode + flight.FlightRef)"
                                                                           value="@price.ClassName" data-keyprice="@price.BookingKey" data-price="@price.TotallPriceAdt">
                                                                    <label class="type" for="@(flight.MainAirlineCode + flight.FlightRef + "-" + price.FareClass)">Hạng vé: @price.FareClass</label>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                    @foreach (var price in flight.PriceBreakDowns)
                                                    {
                                                        int numAdt = searchInput.AdultNumber;
                                                        int numChd = searchInput.ChildNumber;
                                                        int numInf = searchInput.InfantNumber;
                                                        decimal totalPriceOrder = (price.TotallPriceAdt * numAdt) + (price.TotallPriceChd * numChd) + (price.TotallPriceInf * numInf);
                                                        <div data-idtype="@(flight.MainAirlineCode + flight.FlightRef + "-" + price.FareClass)" class="type@(flight.MainAirlineCode + flight.FlightRef + "-" + price.FareClass) ticket-info-type">
                                                            <div class="ticket-section">
                                                                <div class="row">
                                                                    <div class="col-6 col-md-12">
                                                                        <div class="column info">
                                                                            <h3 class="color-info">
                                                                                🔸 THÔNG TIN CHUYẾN BAY (HẠNG VÉ  @(price.ClassName != null ? price.ClassName.ToUpper() : price.CabinClass.ToUpper())  - CABIN @price.CabinClass.ToUpper()):
                                                                            </h3>
                                                                            @foreach (var segment in flight.ListSegment)
                                                                            {
                                                                                <p>
                                                                                    <strong>Khởi hành:</strong>
                                                                                    <span class="color-dark">
                                                                                        @segment.DepartureTime,
                                                                                        @segment.DepartureDate.ToString("dd/MM/yyyy")
                                                                                    </span>
                                                                                    (Giờ @segment.DepartureCountry)
                                                                                </p>
                                                                                <ul>
                                                                                    <li class="color-dark">
                                                                                        <strong>
                                                                                            @segment.DepartureCity - @segment.DepartureAirportName
                                                                                        </strong>
                                                                                    </li>
                                                                                </ul>
                                                                                <p>
                                                                                    <strong>Đến:</strong>
                                                                                    <span class="color-dark">
                                                                                        @segment.ArrivalTime,
                                                                                        @segment.ArrivalDate.ToString("dd/MM/yyyy")
                                                                                    </span>(Giờ @segment.ArrivalCountry)
                                                                                </p>
                                                                                <ul>
                                                                                    <li>
                                                                                        <strong class="color-dark">
                                                                                            @segment.ArrivalCity - @segment.ArrivalAirportName
                                                                                        </strong>
                                                                                    </li>
                                                                                </ul>
                                                                                <p>Thời gian: @segment.Duration | @segment.AircraftName</p>
                                                                            }
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-6 col-md-12 price">
                                                                        <div class="column price">
                                                                            <h3 class="color-info">
                                                                                TỔNG TIỀN VÉ CHIỀU ĐI:
                                                                                <span class="total-price color-info">@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceOrder) Đ</span>
                                                                            </h3>
                                                                            <table>
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th class="color-info">
                                                                                            Hành khách x SL x Giá vé
                                                                                        </th>
                                                                                        <th class="color-info">
                                                                                            Thuế và phí x SL
                                                                                        </th>
                                                                                        <th class="color-info">
                                                                                            Tổng tiền
                                                                                        </th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                    @if (numAdt > 0)
                                                                                    {
                                                                                        decimal taxFeeAdt = price.TaxAdt + price.FeeAdt;
                                                                                        decimal totalPriceAdt = price.TotallPriceAdt * numAdt;
                                                                                        <tr>
                                                                                            <td>Người lớn @numAdt x @ProtechGroup.Application.Common.CoreUtils.FormatPrice(price.FareBaseAdt)</td>
                                                                                            <td>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(taxFeeAdt) x @numAdt  </td>
                                                                                            <td><strong>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceAdt)</strong></td>
                                                                                        </tr>
                                                                                    }
                                                                                    @if (numChd > 0)
                                                                                    {
                                                                                        decimal taxFeeChd = price.TaxChd + price.FeeChd;
                                                                                        decimal totalPriceChd = price.TotallPriceChd * numChd;
                                                                                        <tr>
                                                                                            <td>Trẻ em @numChd x @ProtechGroup.Application.Common.CoreUtils.FormatPrice(price.FareBaseChd)</td>
                                                                                            <td>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(taxFeeChd) x @numChd  </td>
                                                                                            <td><strong>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceChd)</strong></td>
                                                                                        </tr>
                                                                                    }
                                                                                    @if (numInf > 0)
                                                                                    {
                                                                                        decimal taxFeeInf = price.TaxInf + price.FeeInf;
                                                                                        decimal totalPriceInf = price.TotallPriceInf * numInf;
                                                                                        <tr>
                                                                                            <td>Em bé @numInf x @ProtechGroup.Application.Common.CoreUtils.FormatPrice(price.FareBaseInf)</td>
                                                                                            <td>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(taxFeeInf) x @numInf  </td>
                                                                                            <td><strong>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceInf)</strong></td>
                                                                                        </tr>
                                                                                    }
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="ticket-section">
                                                                <h3 class="color-info">🔸 ĐIỀU KIỆN VÉ ÁP DỤNG (@price.ReturnTicket.ToUpper()):</h3>
                                                                @Html.Raw(price.Condition)
                                                            </div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>

                                        </div>
                                    }

                                }


                            </div>
                        </div>
                    </div>
                    @if (searchInput.IsRoundTrip)
                    {
                        <div class="is-placing item-in-bound" style="margin-top: 40px;">
                            <div class="row">
                                <div class="col-3">
                                    <p class="color-info">CHIỀU VỀ </p>
                                    <p class="color-dark">NGÀY @(searchInput.ReturnDate?.ToString("dd/MM/yyyy"))</p>
                                </div>
                                <div class="col-7">
                                    <p class="color-info">@searchInput.ArrivalCity (@searchInput.ArrivalAirport) -> @searchInput.DepartureCity (@searchInput.DepartureAirport)</p>
                                    <p class="color-dark">
                                        @if (searchInput.AdultNumber > 0)
                                        {
                                            @(searchInput.AdultNumber + " NGƯỜI LỚN")
                                        }
                                        @if (searchInput.ChildNumber > 0)
                                        {
                                            @(" | " + searchInput.ChildNumber + " TRẺ EM")
                                        }
                                        @if (searchInput.InfantNumber > 0)
                                        {
                                            @(" | " + searchInput.ChildNumber + " EM BÉ")
                                        }
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="list-ticket item-in-bound">
                            <div class="list-action">
                                @{
                                    DateTime dateIn = Convert.ToDateTime(searchInput.ReturnDate?.ToString("dd/MM/yyyy"));
                                    double totalDaysIn = (dateIn - Convert.ToDateTime(DateTime.Now.ToString("dd/MM/yyyy"))).TotalDays;
                                    DateTime staDateShowIn;
                                    if (totalDays <= 0)
                                    {
                                        staDateShowIn = dateIn;
                                    }
                                    else
                                    {

                                        if (totalDays <= 3)
                                        {
                                            staDateShowIn = dateIn.AddDays(-totalDays);
                                        }
                                        else
                                        {
                                            staDateShowIn = dateIn.AddDays(-3);
                                        }

                                    }
                                    for (int i = 0; i < 7; i++)
                                    {
                                        DateTime dateShowIn = staDateShowIn.AddDays(i);
                                        double dayscheckIn = (dateIn - dateShowIn).TotalDays;
                                        <div class="action-item" data-session="@searchInput.SessionId" data-strdate="@dateShowIn.ToString("dd/MM/yyyy")" data-waytype=1>
                                            <div class="date @(dayscheckIn == 0? Html.Raw("active") : Html.Raw(string.Empty))">
                                                <span class="color-primary">@ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(dateShowIn.DayOfWeek)</span>
                                                <span class="color-dark">@dateShowIn.ToString("dd/MM/yyyy")</span>
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                            <div id="openModelFilter" class="d-none d-block-xxl">
                                <p class="color-dark">Bộ lọc</p>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 6V4M12 6C10.8954 6 10 6.89543 10 8C10 9.10457 10.8954 10 12 10M12 6C13.1046 6 14 6.89543 14 8C14 9.10457 13.1046 10 12 10M6 18C7.10457 18 8 17.1046 8 16C8 14.8954 7.10457 14 6 14M6 18C4.89543 18 4 17.1046 4 16C4 14.8954 4.89543 14 6 14M6 18V20M6 14V4M12 10V20M18 18C19.1046 18 20 17.1046 20 16C20 14.8954 19.1046 14 18 14M18 18C16.8954 18 16 17.1046 16 16C16 14.8954 16.8954 14 18 14M18 18V20M18 14V4"
                                          stroke="#0A7C79" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                            <div class="list-ticket-items list-ticket-items-in">
                                <div class="cheapest">
                                    @foreach (var flight in Model.BlockItems[0].FlightInBounds)
                                    {
                                        if (flight.PriceBreakDowns != null && flight.PriceBreakDowns.Count > 0)
                                        {
                                            <div class="item-ticket item-ticket-in" data-codeairline="@flight.MainAirlineCode" data-session="@searchInput.SessionId" data-keybooking="@flight.BookingKey" data-way="InBound" style="display: block;">
                                                <div class="col-12 d-none d-block-lg">
                                                    <div class="btn-detail mobile">
                                                        <button class="color-dark toggle-info" data-target="#@flight.MainFlightNumber">
                                                            Chi tiết hạng vé
                                                            <svg width="8" height="13" viewBox="0 0 8 13" fill="none"
                                                                 xmlns="http://www.w3.org/2000/svg">
                                                                <path d="M1.5 1.5L6.5 6.5L1.5 11.5" stroke="#FF3C13" stroke-width="1.5"
                                                                      stroke-linecap="round" stroke-linejoin="round"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="row g-lg-2">
                                                    <div class="col-3 d-none-lg">
                                                        <div class="airline-info ">
                                                            <img class="img-logo-airline" src="/Content/img/Airline/sm@(flight.MainAirlineCode + ".gif")" alt="@flight.MainAirlineName">
                                                            <div class="airline-name">
                                                                <span class="color-dark name">@flight.MainAirlineName</span>
                                                                <span class="color-info code">@flight.MainFlightNumber</span>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class="col-5 col-lg-7">
                                                        <div class="flight-details">
                                                            <div class="time-info">
                                                                <div class="departure">
                                                                    <div class="time">@flight.MainDepartureTime</div>
                                                                    <div class="location">@flight.MainDepartureAirportCode</div>
                                                                    @{
                                                                        var dateOfWeekDep = flight.MainDepartureDate.DayOfWeek;
                                                                        string strDateOfWeekDep = ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(dateOfWeekDep);
                                                                        <div class="date d-none-lg">@strDateOfWeekDep - @flight.MainDepartureDate.ToString("dd/MM")</div>
                                                                    }
                                                                </div>
                                                                <div class="arrow-item">
                                                                    <p class="color-dark duration">@flight.Duration</p>
                                                                    <div class="arrow">
                                                                        <span class="d-none-lg">---</span> ✈ <span class="d-none-lg">---</span>
                                                                    </div>
                                                                    @if (flight.Stop < 1)
                                                                    {
                                                                        <p class="color-dark numstop">Bay thẳng</p>
                                                                    }
                                                                    else
                                                                    {
                                                                        <p class="color-dark numstop">@flight.Stop điểm dừng</p>
                                                                    }
                                                                </div>
                                                                <div class="arrival">
                                                                    <div class="time">@flight.MainArrivalTime</div>
                                                                    <div class="location">@flight.MainArrivalAirportCode</div>
                                                                    @{
                                                                        var dateOfWeekArr = flight.MainArrivalDate.DayOfWeek;
                                                                        string strDateOfWeekArr = ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(dateOfWeekArr);
                                                                        <div class="date d-none-lg">@strDateOfWeekArr - @flight.MainArrivalDate.ToString("dd/MM")</div>
                                                                    }
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @{
                                                        var clTicketDefault = flight.PriceBreakDowns[0];
                                                        <div class="col-2 d-none-lg">
                                                            <div class="flight-meta">
                                                                <div>
                                                                    <p class="color-info">Hạng vé</p>
                                                                    <p class="color-dark typeRender">@clTicketDefault.ClassName</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-2 col-lg-5">
                                                            <div class="info-price">
                                                                <span class="color-info price">@ProtechGroup.Application.Common.CoreUtils.FormatPrice(clTicketDefault.TotallPriceAdt) đ</span>
                                                                <div class="color-primary info">
                                                                    Giá cho 1 người lớn
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-3  d-none-lg">
                                                            <div class="btn-detail">
                                                                <button class="color-dark toggle-info" data-target="#@flight.FlightRef">
                                                                    Chi tiết hạng vé
                                                                    <svg width="8" height="13" viewBox="0 0 8 13" fill="none"
                                                                         xmlns="http://www.w3.org/2000/svg">
                                                                        <path d="M1.5 1.5L6.5 6.5L1.5 11.5" stroke="#FF3C13" stroke-width="1.5"
                                                                              stroke-linecap="round" stroke-linejoin="round"></path>
                                                                    </svg>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="col-5  d-none-lg">
                                                            <div class="extras">
                                                                <div class="item">
                                                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                                                         xmlns="http://www.w3.org/2000/svg">
                                                                        <path d="M17.5 11.046C15.1839 11.9836 12.6523 12.4998 10 12.4998C7.34775 12.4998 4.81608 11.9836 2.5 11.046M13.3333 4.99984V3.33317C13.3333 2.4127 12.5871 1.6665 11.6667 1.6665H8.33333C7.41286 1.6665 6.66667 2.4127 6.66667 3.33317V4.99984M10 9.99984H10.0083M4.16667 16.6665H15.8333C16.7538 16.6665 17.5 15.9203 17.5 14.9998V6.6665C17.5 5.74603 16.7538 4.99984 15.8333 4.99984H4.16667C3.24619 4.99984 2.5 5.74603 2.5 6.6665V14.9998C2.5 15.9203 3.24619 16.6665 4.16667 16.6665Z"
                                                                              stroke="#FF3C13" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                                        </path>
                                                                    </svg>
                                                                    <p class="color-info">@clTicketDefault.RecommendationNumber</p>
                                                                </div>
                                                                <div class="item">
                                                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                                                         xmlns="http://www.w3.org/2000/svg">
                                                                        <path d="M10 6.66667V17.5M10 6.66667C10 6.66667 10 5.42269 10 5C10 4.07953 10.7462 3.33333 11.6667 3.33333C12.5871 3.33333 13.3333 4.07953 13.3333 5C13.3333 5.92047 12.5871 6.66667 11.6667 6.66667C11.1689 6.66667 10 6.66667 10 6.66667ZM10 6.66667C10 6.66667 10 5.05243 10 4.58333C10 3.43274 9.06726 2.5 7.91667 2.5C6.76607 2.5 5.83333 3.43274 5.83333 4.58333C5.83333 5.73393 6.76607 6.66667 7.91667 6.66667C8.59817 6.66667 10 6.66667 10 6.66667ZM4.16667 10H15.8333M4.16667 10C3.24619 10 2.5 9.25381 2.5 8.33333C2.5 7.41286 3.24619 6.66667 4.16667 6.66667H15.8333C16.7538 6.66667 17.5 7.41286 17.5 8.33333C17.5 9.25381 16.7538 10 15.8333 10M4.16667 10L4.16667 15.8333C4.16667 16.7538 4.91286 17.5 5.83333 17.5H14.1667C15.0871 17.5 15.8333 16.7538 15.8333 15.8333V10"
                                                                              stroke="#FF3C13" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                                        </path>
                                                                    </svg>
                                                                    <p class="color-info">@clTicketDefault.AllowanceBaggage</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                    <div class="col-1 ">
                                                        <div class="change-seat d-none">
                                                            <select name="" id="">
                                                                <option value="">Đổi hạng vé</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="line-decor col-12 d-none  d-block-lg"></div>
                                                    <div class="col-3 col-lg-6 col-md-8  d-none d-block-lg">
                                                        <div class="airline-info-mobile row-cols-lg-2">
                                                            <img src="/Content/img/Airline/sm@(flight.MainAirlineCode + ".gif")" alt="@flight.MainAirlineName">
                                                            <div class="airline-name">
                                                                <span class="color-dark name">@flight.MainAirlineName</span>
                                                                <span class="color-info code">@flight.FlightRef</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-3 col-lg-6 col-md-4">
                                                        @if (!searchInput.IsRoundTrip)
                                                        {
                                                            <div class="btn-booking">
                                                                <a class="btn btn-info btn-order-oneway">ĐẶT VÉ</a>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <div class="btn-booking">
                                                                <a class="btn btn-info btn-select-round-trip">CHỌN</a>
                                                            </div>
                                                        }
                                                    </div>

                                                    <div class="info-ticket color-primary" id="@flight.FlightRef">
                                                        <div class="ticket-types">
                                                            <a href="~/Views/OrderBooking/ConfirmCusInformation.cshtml"></a><div class="row row-cols-12 row-cols-md-3  g-md-1">
                                                                @foreach (var price in flight.PriceBreakDowns)
                                                                {
                                                                    <div class="col">
                                                                        <input hidden="" type="radio" class="inputChangeType" id="@(flight.MainAirlineCode + flight.FlightRef + "-" + price.FareClass)" name="type_@(flight.MainAirlineCode + flight.FlightRef)"
                                                                               value="@price.ClassName" data-keyprice="@price.BookingKey" data-price="@price.TotallPriceAdt">
                                                                        <label class="type" for="@(flight.MainAirlineCode + flight.FlightRef + "-" + price.FareClass)">Hạng vé: @price.FareClass</label>
                                                                    </div>
                                                                }
                                                            </div>
                                                        </div>
                                                        @foreach (var price in flight.PriceBreakDowns)
                                                        {
                                                            int numAdt = searchInput.AdultNumber;
                                                            int numChd = searchInput.ChildNumber;
                                                            int numInf = searchInput.InfantNumber;
                                                            decimal totalPriceOrder = (price.TotallPriceAdt * numAdt) + (price.TotallPriceChd * numChd) + (price.TotallPriceInf * numInf);
                                                            <div data-idtype="@(flight.MainAirlineCode + flight.FlightRef + "-" + price.FareClass)" class="type@(flight.MainAirlineCode + flight.FlightRef + "-" + price.FareClass) ticket-info-type">
                                                                <div class="ticket-section">
                                                                    <div class="row">
                                                                        <div class="col-6 col-md-12">
                                                                            <div class="column info">
                                                                                <h3 class="color-info">
                                                                                    🔸 THÔNG TIN CHUYẾN BAY (HẠNG VÉ  @(price.ClassName != null ? price.ClassName.ToUpper() : price.CabinClass.ToUpper())  - CABIN @price.CabinClass.ToUpper()):
                                                                                </h3>
                                                                                @foreach (var segment in flight.ListSegment)
                                                                                {
                                                                                    <p>
                                                                                        <strong>Khởi hành:</strong>
                                                                                        <span class="color-dark">
                                                                                            @segment.DepartureTime,
                                                                                            @segment.DepartureDate.ToString("dd/MM/yyyy")
                                                                                        </span>
                                                                                        (Giờ @segment.DepartureCountry)
                                                                                    </p>
                                                                                    <ul>
                                                                                        <li class="color-dark">
                                                                                            <strong>
                                                                                                @segment.DepartureCity - @segment.DepartureAirportName
                                                                                            </strong>
                                                                                        </li>
                                                                                    </ul>
                                                                                    <p>
                                                                                        <strong>Đến:</strong>
                                                                                        <span class="color-dark">
                                                                                            @segment.ArrivalTime,
                                                                                            @segment.ArrivalDate.ToString("dd/MM/yyyy")
                                                                                        </span>(Giờ @segment.ArrivalCountry)
                                                                                    </p>
                                                                                    <ul>
                                                                                        <li>
                                                                                            <strong class="color-dark">
                                                                                                @segment.ArrivalCity - @segment.ArrivalAirportName
                                                                                            </strong>
                                                                                        </li>
                                                                                    </ul>
                                                                                    <p>Thời gian: @segment.Duration | @segment.AircraftName</p>
                                                                                }
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-6 col-md-12 price">
                                                                            <div class="column price">
                                                                                <h3 class="color-info">
                                                                                    TỔNG TIỀN VÉ CHIỀU VỀ:
                                                                                    <span class="total-price color-info">@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceOrder) Đ</span>
                                                                                </h3>
                                                                                <table>
                                                                                    <thead>
                                                                                        <tr>
                                                                                            <th class="color-info">
                                                                                                Hành khách x SL x Giá vé
                                                                                            </th>
                                                                                            <th class="color-info">
                                                                                                Thuế và phí x SL
                                                                                            </th>
                                                                                            <th class="color-info">
                                                                                                Tổng tiền
                                                                                            </th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                        @if (numAdt > 0)
                                                                                        {
                                                                                            decimal taxFeeAdt = price.TaxAdt + price.FeeAdt;
                                                                                            decimal totalPriceAdt = price.TotallPriceAdt * numAdt;
                                                                                            <tr>
                                                                                                <td>Người lớn @numAdt x @ProtechGroup.Application.Common.CoreUtils.FormatPrice(price.FareBaseAdt)</td>
                                                                                                <td>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(taxFeeAdt) x @numAdt</td>
                                                                                                <td><strong>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceAdt)</strong></td>
                                                                                            </tr>
                                                                                        }
                                                                                        @if (numChd > 0)
                                                                                        {
                                                                                            decimal taxFeeChd = price.TaxChd + price.FeeChd;
                                                                                            decimal totalPriceChd = price.TotallPriceChd * numChd;
                                                                                            <tr>
                                                                                                <td>Trẻ em @numChd x @ProtechGroup.Application.Common.CoreUtils.FormatPrice(price.FareBaseChd)</td>
                                                                                                <td>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(taxFeeChd) x @numChd  </td>
                                                                                                <td><strong>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceChd)</strong></td>
                                                                                            </tr>
                                                                                        }
                                                                                        @if (numInf > 0)
                                                                                        {
                                                                                            decimal taxFeeInf = price.TaxInf + price.FeeInf;
                                                                                            decimal totalPriceInf = price.TotallPriceInf * numInf;
                                                                                            <tr>
                                                                                                <td>Em bé @numInf x @ProtechGroup.Application.Common.CoreUtils.FormatPrice(price.FareBaseInf)</td>
                                                                                                <td>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(taxFeeInf) x @numInf  </td>
                                                                                                <td><strong>@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceInf)</strong></td>
                                                                                            </tr>
                                                                                        }
                                                                                    </tbody>
                                                                                </table>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="ticket-section">
                                                                    <h3 class="color-info">🔸 ĐIỀU KIỆN VÉ ÁP DỤNG (@price.ReturnTicket.ToUpper()):</h3>
                                                                    @Html.Raw(price.Condition)
                                                                </div>
                                                            </div>
                                                        }
                                                    </div>
                                                </div>

                                            </div>
                                        }

                                    }


                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</main>
<script src="~/Scripts/modules/resultFlightDomestic.js"></script>
