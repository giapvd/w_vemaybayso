@model ProtechGroup.Domain.FlightResultOutput
@{
    var searchInput = (ProtechGroup.Domain.Entities.SearchInputMod)ViewBag.SearchInput;
    ViewBag.Title = "Kết quả tìm kiếm chuyến bay";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int numAdt = searchInput.AdultNumber;
    int numChd = searchInput.ChildNumber;
    int numInf = searchInput.InfantNumber;
    int totalPax = numAdt + numChd + numInf;
}

@Html.AntiForgeryToken()
<section class="container mx-auto mt-7.5 relative" id="form-search">
    @Html.Partial("_Nav")
    @Html.Partial("_FrmSearchAirports")
</section>
<section id="loading" class="container box-sha shadow-[0_8px_20px_rgba(0,0,0,0.15)]" style="display:flex; justify-content:center; align-items:center; height:300px;">
    <img src="~/Content/img/search_loading.gif" alt="Đang tìm chuyến bay..." style="width: 100px; height: 100px;">
</section>
<input type="hidden" value="@searchInput.IsRoundTrip.ToString()" id="roundTrip" />
<section class="container mx-auto mt-8" id="flight-list">
    <div class="header-section flex justify-between max-lg:flex-wrap gap-4">
        <div>
            <p class="text-2xl font-bold">Danh sách chuyến bay</p>
            <p class="text-sm text-[#00ABC0]">
                Giá vé chưa bao gồm thuế và các loại thuế khác, khách hàng lưu ý chọn giá để xem đầy đủ.
            </p>
        </div>
        <div class="font-bold">
            <button class="text-base max-md:text-xs p-3 cursor-pointer">
                <img src="~/Content/img/flight-list/style1.svg" alt="" />
            </button>
            <button class="text-base max-md:text-xs p-3 cursor-pointer">
                <img src="~/Content/img/flight-list/style2.svg" alt="" />
            </button>
        </div>
    </div>
    <div class="content mt-10">
        <div class="grid-cols-4 grid gap-5 items-start">
            <div class="filter box-sha rounded-xl col-span-1 p-5 shadow-[0_0_18px_rgba(0,0,0,0.15)] max-xl:hidden box-filter">
                <div class="head flex justify-between items-center pb-6 border-b border-[#00ABC0]">
                    <p class="text-base font-bold">Bộ lọc</p>
                    <div>
                        <img src="~/Content/img/flight-list/filter.svg" alt="">
                    </div>
                </div>
                <!-- //Box -->
                <div class="box py-4 border-b border-[#00ABC0]">
                    <div class="head flex justify-between items-center pb-6">
                        <p class="text-base font-bold">Sắp xếp</p>
                        <div>
                            <svg width="15" height="9" viewBox="0 0 15 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M13.75 0.75L7.25 7.75L0.75 0.75" stroke="#0E0F52" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="body flex flex-col gap-3 filter-content" id="box-filter-sx">
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox" value="price">
                            <p class="text-sm">Giá (Từ thấp đến cao)</p>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox" value="time">
                            <p class="text-sm">Giờ cất cánh (Sớm đến muộn)</p>
                        </label>
                    </div>
                </div>
                <!-- //Box -->
                <div class="box py-4 border-b border-[#00ABC0] box-show" id="box-show-price">
                    <div class="head flex justify-between items-center pb-6">
                        <p class="text-base font-bold">Hiển thị giá vé</p>
                        <div>
                            <svg width="15" height="9" viewBox="0 0 15 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M13.75 0.75L7.25 7.75L0.75 0.75" stroke="#0E0F52" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="body flex flex-col gap-3">
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox" value="priceBase">
                            <p class="text-sm">Giá chưa bao gồm thuế phí</p>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox" value="priceFullAdt">
                            <p class="text-sm">Giá full thuế phí cho 1 người lớn</p>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox" value="priceFullAllPax">
                            <p class="text-sm">Tổng giá cho tất cả hành khách</p>
                        </label>
                    </div>
                </div>
                <!-- //Box -->
                <div class="box py-4 border-b border-[#00ABC0]">
                    <div class="head flex justify-between items-center pb-6">
                        <p class="text-base font-bold">Lọc Hãng hàng không</p>
                        <div>
                            <svg width="15" height="9" viewBox="0 0 15 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M13.75 0.75L7.25 7.75L0.75 0.75" stroke="#0E0F52" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="body flex flex-col gap-3" id="box-filter-lth">
                        @foreach (var airline in Model.Airlines)
                        {
                            <label class="flex items-center gap-3 cursor-pointer select-none">
                                <input type="checkbox" value="@airline.AirlineCode" />
                                <div class="flex justify-between flex-1 items-center">
                                    <span class="text-sm font-semibold">@airline.AirlineName</span>
                                    <img src="~/Content/img/Airline/sm@(airline.AirlineCode + ".gif")" alt="@airline.AirlineName" style="width:32px; height:32px" />
                                </div>
                            </label>
                        }
                    </div>
                </div>
                <div class="box py-4">
                    <div class="head flex justify-between items-center pb-6">
                        <p class="text-base font-bold">Giờ cất cánh</p>
                        <div>
                            <svg width="15" height="9" viewBox="0 0 15 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M13.75 0.75L7.25 7.75L0.75 0.75" stroke="#0E0F52" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="body flex flex-col gap-3" id="box-filter-time">
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox">
                            <div class="flex justify-between flex-1 items-center">
                                <p class="text-sm">Cả ngày</p>
                                <p class="text-sm font-bold time-filter">00:00 - 24:00</p>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox">
                            <div class="flex justify-between flex-1 items-center">
                                <p class="text-sm">Buổi sớm</p>
                                <p class="text-sm font-bold time-filter">00:00 - 06:00</p>
                            </div>
                        </label>
                        <!-- // -->
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox">
                            <div class="flex justify-between flex-1 items-center">
                                <p class="text-sm">Buổi sáng</p>
                                <p class="text-sm font-bold time-filter">06:00 - 12:00</p>
                            </div>
                        </label>
                        <!-- // -->
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox">
                            <div class="flex justify-between flex-1 items-center">
                                <p class="text-sm">Buổi chiều</p>
                                <p class="text-sm font-bold time-filter">12:00 - 18:00</p>
                            </div>
                        </label>
                        <!-- // -->
                        <label class="flex items-center gap-3 cursor-pointer select-none">
                            <input type="checkbox">
                            <div class="flex justify-between flex-1 items-center">
                                <p class="text-sm">Buổi tối</p>
                                <p class="text-sm font-bold time-filter">18:00 - 24:00</p>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="flight-list col-span-3  max-xl:col-span-4 ">
                <div class="flex flex-col gap-4">
                    <div class="plane-items-selected shadow-[0_8px_20px_rgba(0,0,0,0.15)] rounded-xl overflow-hidden">
                        <section id="select-out-bound"></section>
                        <section id="select-in-bound"></section>
                        <div class="border-t border-[#EBA00A] border-dotted py-4 px-10 flex  justify-between gap-10 max-md:flex-col max-md:gap-5 conditions">
                            <div class="flex justify-between items-center" style=" width: 100%;">
                                <div>
                                    <p class="min-w-[127px] text-end text-[22px] text-accent leading-5.5 price">
                                        <span class="font-bold">Tổng tiền: </span><span id="display-price-order">0 VNĐ</span>
                                    </p>
                                </div>
                                <div>
                                    <button class="w-full h-full text-sm uppercase font-bold bg-primary text-white px-5 py-1.5 max-xl:px-3 max-xl:py-1 max-lg:px-5 max-lg:py-1.5 rounded-br-3xl rounded-tl-3xl" id="btn-order-flight">
                                        Đặt vé
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-primary rounded-xl p-4 text-white pr-10 shadow-[0_8px_20px_rgba(0,0,0,0.15)]">
                        <div class="flex justify-between items-center max-lg:flex-wrap gap-4">
                            <div>
                                <p class="mb-1 font-bold text-base">
                                    <span>@searchInput.DepartureCity (@searchInput.DepartureAirport) - @searchInput.ArrivalCity (@searchInput.ArrivalAirport)</span>
                                    <span class="mx-4 max-lg:hidden">|</span>
                                    <span class="max-lg:block">Khởi hành: @ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(searchInput.DepartureDate.DayOfWeek), Ngày @searchInput.DepartureDate.ToString("dd") Tháng @searchInput.DepartureDate.ToString("MM") Năm @searchInput.DepartureDate.ToString("yyyy")</span>
                                </p>
                                <p class="text-base">
                                    @numAdt Người lớn | @numChd  Trẻ em | @numInf Em bé
                                </p>
                            </div>
                            <div class="">
                                <button class="px-4 py-1 uppercase bg-highlight font-bold rounded-br-3xl rounded-tl-3xl" onclick="changeSelectedFlight(0)">
                                    Thay đổi
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="rounded-xl px-4 py-1 shadow-[0_8px_20px_rgba(0,0,0,0.15)]">
                        <div class="flex justify-between items-center">
                            <div>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="24" height="24" rx="10" fill="#0E0F52" />
                                    <path d="M13.5714 17L9 12L13.5714 7L15 8.55208L11.7429 12L15 15.4479L13.5714 17Z" fill="white" />
                                </svg>
                            </div>
                            <div class="flex justify-between items-center w-10/12 overflow-hidden gap-8">
                                @{
                                    DateTime dateOut = searchInput.DepartureDate;
                                    double totalDays = (dateOut - Convert.ToDateTime(DateTime.Now.ToString("dd/MM/yyyy"))).TotalDays;
                                    DateTime staDateShow;
                                    if (totalDays <= 0)
                                    {
                                        staDateShow = dateOut;
                                    }
                                    else
                                    {

                                        if (totalDays <= 2)
                                        {
                                            staDateShow = dateOut.AddDays(-totalDays);
                                        }
                                        else
                                        {
                                            staDateShow = dateOut.AddDays(-2);
                                        }

                                    }
                                    for (int i = 0; i < 5; i++)
                                    {
                                        DateTime dateShow = staDateShow.AddDays(i);
                                        double dayscheck = (dateOut - dateShow).TotalDays;
                                        DateTime lunarDate = ProtechGroup.Application.Common.CoreUtils.ConvertSolarToLunarVN(dateShow);
                                        <div class="date flex flex-col items-center min-h-15 justify-between p-1 w-1/5 @(dayscheck == 0? Html.Raw("bg-bg-info font-bold") : Html.Raw(string.Empty))" data-session="@searchInput.SessionId" data-strdate="@dateShow.ToString("dd/MM/yyyy")" data-waytype=0>
                                            <p class="text-xs text-text-primary">@ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(dateShow.DayOfWeek)</p>
                                            <p class="text-xs text-text-primary">@dateShow.ToString("dd") tháng @dateShow.ToString("MM")</p>
                                            <p class="text-xs text-accent"><span class="text-sm font-bold">@lunarDate.ToString("dd - MM")</span> âm lịch</p>
                                        </div>
                                    }
                                }
                            </div>
                            <div>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="24" height="24" rx="10" fill="#0E0F52" />
                                    <path d="M10.4286 7L15 12L10.4286 17L9 15.4479L12.2571 12L9 8.55208L10.4286 7Z" fill="white" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="rounded-xl px-4 py-1 shadow-[0_8px_20px_rgba(0,0,0,0.15)] font-bold flex justify-between items-center">
                        <p>Chuyến bay đi</p>
                        <div class="flex">
                            <p class="px-7 py-2 border-r border-gray-200">Phổ thông</p>
                            <p class="px-7 py-2 text-highlight">Thương gia</p>
                        </div>
                    </div>
                    <div class="list-ticket-items-out">
                        @foreach (var flight in Model.BlockItems[0].FlightOutBounds)
                        {
                            if (flight.PriceBreakDowns != null && flight.PriceBreakDowns.Count > 0)
                            {
                                var clTicketDefault = flight.PriceBreakDowns[0];
                                decimal totalPriceOrderDf = (clTicketDefault.TotallPriceAdt * numAdt) + (clTicketDefault.TotallPriceChd * numChd) + (clTicketDefault.TotallPriceInf * numInf);
                                var clTicketEnd = flight.PriceBreakDowns[flight.PriceBreakDowns.Count - 1];
                                decimal totalPriceOrderEd = (clTicketEnd.TotallPriceAdt * numAdt) + (clTicketEnd.TotallPriceChd * numChd) + (clTicketEnd.TotallPriceInf * numInf);
                                string priceFrom = @ProtechGroup.Application.Common.CoreUtils.FormatPrice(clTicketDefault.TotallPriceAdt);
                                string priceEnd = @ProtechGroup.Application.Common.CoreUtils.FormatPrice(clTicketEnd.TotallPriceAdt);
                                string firstPart_pf = priceFrom.Length > 3 ? priceFrom.Substring(0, priceFrom.Length - 3) : "";
                                string last3_pf = priceFrom.Length > 3 ? priceFrom.Substring(priceFrom.Length - 3) : priceFrom;
                                string firstPart_pe = priceEnd.Length > 3 ? priceEnd.Substring(0, priceEnd.Length - 3) : "";
                                string last3_pe = priceEnd.Length > 3 ? priceEnd.Substring(priceEnd.Length - 3) : priceEnd;

                                <div class="plane-items rounded-xl px-4 py-4 shadow-[0_8px_20px_rgba(0,0,0,0.15)] flex flex-col gap-4 item-out-bound" data-price="@clTicketDefault.TotallPriceAdt" style="margin-bottom: 15px;">
                                    <div class="grid grid-cols-8 items-center gap-4 items-stretch">
                                        <div class="col-span-2">
                                            <div class="flex flex-col gap-4">
                                                <div class="flex gap-3 items-start">
                                                    <div>
                                                        <img src="~/Content/img/Airline/sm@(flight.MainAirlineCode + ".gif")" alt="@flight.MainAirlineName" class="w-10" />
                                                    </div>
                                                    <div class="text-sm">
                                                        <p class="font-bold">@flight.MainAirlineName</p>
                                                        <p>@flight.MainFlightNumber - @flight.Plane</p>
                                                    </div>
                                                </div>
                                                <!-- //// -->
                                            </div>
                                        </div>
                                        <div class="col-span-3 max-lg:col-span-4 py-2">
                                            <div class="flex flex-col justify-between h-full">
                                                <div class="flex justify-between items-center">
                                                    <div class="flex gap-1 items-center departure">
                                                        <p class="text-2xl font-bold time">@flight.MainDepartureTime</p>
                                                        <p class="text-base">@flight.MainDepartureAirportCode</p>
                                                    </div>
                                                    <div class="flex flex-col items-center">
                                                        <p class="text-xs text-[#D3D9DC]">@flight.Duration</p>
                                                        <img src="~/Content/img/flight-list/item-flight-list/plane.svg" alt="" />
                                                        @if (flight.Stop < 1)
                                                        {
                                                            <p class="text-xs text-[#D3D9DC]">Bay thẳng</p>
                                                        }
                                                        else
                                                        {
                                                            <p class="text-xs text-[#D3D9DC]">@flight.Stop điểm dừng</p>
                                                        }
                                                    </div>
                                                    <div class="flex gap-1 items-center">
                                                        <p class="text-base">@flight.MainArrivalAirportCode</p>
                                                        <p class="text-2xl font-bold">@flight.MainArrivalTime</p>
                                                    </div>
                                                </div>
                                                <div class="flex justify-between">
                                                    <div class="flex items-center">
                                                        <img src="~/Content/img/flight-list/item-flight-list/bag1.svg" alt="" />
                                                        <p class="text-xs">@clTicketDefault.RecommendationNumber</p>
                                                    </div>
                                                    <div class="flex items-center">
                                                        <img src="~/Content/img/flight-list/item-flight-list/bag2.svg" alt="" />
                                                        <p class="text-xs">@clTicketDefault.AllowanceBaggage</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-span-3 max-lg:col-span-2 content-price">
                                            <div class="flex gap-4 justify-end items-center cursor-pointer select-none detail ">
                                                <div class="p-2 border border-bg-info rounded-lg">
                                                    <p class="text-xs">Từ</p>
                                                    <p class="min-w-[127px] text-end text-[22px] text-accent leading-5.5 price" data-price-base-adt="@clTicketDefault.FareBaseAdt" data-base-full-adt="@clTicketDefault.TotallPriceAdt" data-price-full-pax="@totalPriceOrderDf">
                                                        <span class="font-bold">@firstPart_pf</span> <br />@last3_pf VNĐ
                                                    </p>
                                                    <p class="text-end text-sm">Giá 01 người lớn</p>
                                                    <p class="text-end font-bold text-xs">Chọn giá ></p>
                                                </div>
                                                <div class="min-w-[127px] p-2 border border-highlight rounded-lg max-lg:hidden">
                                                    <p class="text-xs">Đến</p>
                                                    <p class="text-end text-[22px] text-accent leading-5.5 price-end" data-price-base-adt="@clTicketEnd.FareBaseAdt" data-base-full-adt="@clTicketEnd.TotallPriceAdt" data-price-full-pax="@totalPriceOrderEd">
                                                        <span class="font-bold">@firstPart_pe</span> <br />@last3_pe VNĐ
                                                    </p>
                                                    <p class="text-end text-sm">Giá 01 người lớn</p>
                                                    <p class="text-end font-bold text-xs">Chọn giá ></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="hidden relative list-card-price bg-bg-info rounded-xl p-5 flex justify-between items-center overflow-hidden">
                                        <div class="pre absolute left-4 top-1/2 -translate-y-1/2 cursor-pointer z-1">
                                            <button class="bg-primary text-white rounded-xl p-3 opacity-60 cursor-pointer">&lt;</button>
                                        </div>
                                        <div class="next absolute right-4 top-1/2 -translate-y-1/2 cursor-pointer z-1">
                                            <button class="bg-primary text-white rounded-xl p-3 opacity-60 cursor-pointer">&gt;</button>
                                        </div>
                                        @foreach (var price in flight.PriceBreakDowns)
                                        {
                                            decimal totalPriceOrder = (price.TotallPriceAdt * numAdt) + (price.TotallPriceChd * numChd) + (price.TotallPriceInf * numInf);
                                            <div class="card-price max-w-1/4 min-w-1/4  p-5  rounded-xl  shadow-[0_8px_20px_rgba(0,0,0,0.1)] bg-white max-lg:max-w-1/3 max-lg:min-w-1/3 max-md:max-w-1/2 max-md:min-w-1/2 max-sm:max-w-full max-sm:min-w-full">
                                                <div class="flex flex-col gap-4 items-center">
                                                    <p class="text-xs font-bold">@price.ClassName</p>
                                                    <div>
                                                        <p class="text-accent text-base text-center font-bold">@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceOrder) VND</p>
                                                        <p class="text-[#B3B0D8] text-xs">Giá vé cho @totalPax hành khách</p>
                                                    </div>
                                                    <div>
                                                        <button class="bg-accent text-sm py-1 px-5 text-white rounded-2xl select-flight" 
                                                       data-codeairline="@flight.MainAirlineCode" data-session="@searchInput.SessionId" data-keybooking="@price.BookingKey" data-way="OutBound" data-total-price="@totalPriceOrder">Chọn vé</button>
                                                    </div>
                                                </div>
                                                <div class="info mt-5">
                                                    <ul class="border-b border-gray-300 border-dotted pb-4 mb-4">
                                                        <li class="flex gap-2 items-center">
                                                            <img src="~/Content/img/flight-list/item-flight-list/bag1.svg" alt="" />
                                                            <p class="text-xs">@price.RecommendationNumber</p>
                                                        </li>
                                                        <li class="flex gap-2 items-center">
                                                            <img src="~/Content/img/flight-list/item-flight-list/bag2.svg" alt="" />
                                                            <p class="text-xs">@price.AllowanceBaggage</p>
                                                        </li>
                                                    </ul>
                                                    <ul class="border-b border-gray-300 border-dotted pb-4 mb-4">
                                                        <li class="flex gap-2 items-center">
                                                            <img src="~/Content/img/flight-info/ticket.svg" alt="" style="width:24px; height:24px;" />
                                                            <p class="text-xs">@price.ReturnTicket</p>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                        }
                    </div>

                    @if (searchInput.IsRoundTrip)
                    {
                        DateTime returnDate = Convert.ToDateTime(searchInput.ReturnDate?.ToString("dd/MM/yyyy"));
                        <div class="bg-primary rounded-xl p-4 text-white pr-10 shadow-[0_8px_20px_rgba(0,0,0,0.15)]">
                            <div class="flex justify-between items-center max-lg:flex-wrap gap-4">
                                <div>
                                    <p class="mb-1 font-bold text-base">
                                        <span> @searchInput.ArrivalCity (@searchInput.ArrivalAirport) - @searchInput.DepartureCity (@searchInput.DepartureAirport)</span>
                                        <span class="mx-4 max-lg:hidden">|</span>
                                        <span class="max-lg:block">Khởi hành: @ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(returnDate.DayOfWeek), Ngày @returnDate.ToString("dd") Tháng @returnDate.ToString("MM") Năm @returnDate.ToString("yyyy")</span>
                                    </p>
                                    <p class="text-base">
                                        @searchInput.AdultNumber Người lớn | @searchInput.ChildNumber  Trẻ em | @searchInput.ChildNumber Em bé
                                    </p>
                                </div>
                                <div class="">
                                    <button class="px-4 py-1 uppercase bg-highlight font-bold rounded-br-3xl rounded-tl-3xl" onclick="changeSelectedFlight(1)">
                                        Thay đổi
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="rounded-xl px-4 py-1 shadow-[0_8px_20px_rgba(0,0,0,0.15)]">
                            <div class="flex justify-between items-center">
                                <div>
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect width="24" height="24" rx="10" fill="#0E0F52" />
                                        <path d="M13.5714 17L9 12L13.5714 7L15 8.55208L11.7429 12L15 15.4479L13.5714 17Z" fill="white" />
                                    </svg>
                                </div>
                                <div class="flex justify-between items-center w-10/12 overflow-hidden gap-8">
                                    @{
                                        double totalDaysIn = (returnDate - Convert.ToDateTime(DateTime.Now.ToString("dd/MM/yyyy"))).TotalDays;
                                        DateTime staDateShowIn;
                                        if (totalDays <= 0)
                                        {
                                            staDateShowIn = returnDate;
                                        }
                                        else
                                        {

                                            if (totalDays <= 2)
                                            {
                                                staDateShowIn = returnDate.AddDays(-totalDays);
                                            }
                                            else
                                            {
                                                staDateShowIn = returnDate.AddDays(-2);
                                            }

                                        }
                                        for (int i = 0; i < 5; i++)
                                        {
                                            DateTime dateShowIn = staDateShowIn.AddDays(i);
                                            double dayscheckIn = (returnDate - dateShowIn).TotalDays;
                                            DateTime lunarDateIn = ProtechGroup.Application.Common.CoreUtils.ConvertSolarToLunarVN(dateShowIn);
                                            <div class="date flex flex-col items-center min-h-15 justify-between p-1 w-1/5 @(dayscheckIn == 0? Html.Raw("bg-bg-info font-bold") : Html.Raw(string.Empty))" data-session="@searchInput.SessionId" data-strdate="@dateShowIn.ToString("dd/MM/yyyy")" data-waytype=0>
                                                <p class="text-xs text-text-primary">@ProtechGroup.Application.Common.CoreUtils.GetLangDayOfWeek(dateShowIn.DayOfWeek)</p>
                                                <p class="text-xs text-text-primary">@dateShowIn.ToString("dd") tháng @dateShowIn.ToString("MM")</p>
                                                <p class="text-xs text-accent"><span class="text-sm font-bold">@lunarDateIn.ToString("dd-MM")</span> âm lịch </p>
                                            </div>
                                        }
                                    }
                                </div>
                                <div>
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect width="24" height="24" rx="10" fill="#0E0F52" />
                                        <path d="M10.4286 7L15 12L10.4286 17L9 15.4479L12.2571 12L9 8.55208L10.4286 7Z" fill="white" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="rounded-xl px-4 py-1 shadow-[0_8px_20px_rgba(0,0,0,0.15)] font-bold flex justify-between items-center">
                            <p>Chuyến bay về</p>
                            <div class="flex">
                                <p class="px-7 py-2 border-r border-gray-200">Phổ thông</p>
                                <p class="px-7 py-2 text-highlight">Thương gia</p>
                            </div>
                        </div>
                        <div class="list-ticket-items-in">
                            @foreach (var flight in Model.BlockItems[0].FlightInBounds)
                            {
                                if (flight.PriceBreakDowns != null && flight.PriceBreakDowns.Count > 0)
                                {
                                    var clTicketDefault = flight.PriceBreakDowns[0];
                                    decimal totalPriceOrderDf = (clTicketDefault.TotallPriceAdt * numAdt) + (clTicketDefault.TotallPriceChd * numChd) + (clTicketDefault.TotallPriceInf * numInf);
                                    var clTicketEnd = flight.PriceBreakDowns[flight.PriceBreakDowns.Count - 1];
                                    decimal totalPriceOrderEd = (clTicketEnd.TotallPriceAdt * numAdt) + (clTicketEnd.TotallPriceChd * numChd) + (clTicketEnd.TotallPriceInf * numInf);
                                    string priceFrom = @ProtechGroup.Application.Common.CoreUtils.FormatPrice(clTicketDefault.TotallPriceAdt);
                                    string priceEnd = @ProtechGroup.Application.Common.CoreUtils.FormatPrice(clTicketEnd.TotallPriceAdt);
                                    string firstPart_pf = priceFrom.Length > 3 ? priceFrom.Substring(0, priceFrom.Length - 3) : "";
                                    string last3_pf = priceFrom.Length > 3 ? priceFrom.Substring(priceFrom.Length - 3) : priceFrom;
                                    string firstPart_pe = priceEnd.Length > 3 ? priceEnd.Substring(0, priceEnd.Length - 3) : "";
                                    string last3_pe = priceEnd.Length > 3 ? priceEnd.Substring(priceEnd.Length - 3) : priceEnd;

                                    <div class="plane-items rounded-xl px-4 py-4 shadow-[0_8px_20px_rgba(0,0,0,0.15)] flex flex-col gap-4 item-in-bound" data-price="@clTicketDefault.TotallPriceAdt" style="margin-bottom: 15px;">
                                        <div class="grid grid-cols-8 items-center gap-4 items-stretch">
                                            <div class="col-span-2">
                                                <div class="flex flex-col gap-4">
                                                    <div class="flex gap-3 items-start">
                                                        <div>
                                                            <img src="~/Content/img/Airline/sm@(flight.MainAirlineCode + ".gif")" alt="@flight.MainAirlineName" class="w-10" />
                                                        </div>
                                                        <div class="text-sm">
                                                            <p class="font-bold">@flight.MainAirlineName</p>
                                                            <p>@flight.MainFlightNumber - @flight.Plane</p>
                                                        </div>
                                                    </div>
                                                    <!-- //// -->
                                                </div>
                                            </div>
                                            <div class="col-span-3 max-lg:col-span-4 py-2">
                                                <div class="flex flex-col justify-between h-full">
                                                    <div class="flex justify-between items-center">
                                                        <div class="flex gap-1 items-center departure">
                                                            <p class="text-2xl font-bold time">@flight.MainDepartureTime</p>
                                                            <p class="text-base">@flight.MainDepartureAirportCode</p>
                                                        </div>
                                                        <div class="flex flex-col items-center">
                                                            <p class="text-xs text-[#D3D9DC]">@flight.Duration</p>
                                                            <img src="~/Content/img/flight-list/item-flight-list/plane.svg" alt="" />
                                                            @if (flight.Stop < 1)
                                                            {
                                                                <p class="text-xs text-[#D3D9DC]">Bay thẳng</p>
                                                            }
                                                            else
                                                            {
                                                                <p class="text-xs text-[#D3D9DC]">@flight.Stop điểm dừng</p>
                                                            }
                                                        </div>
                                                        <div class="flex gap-1 items-center">
                                                            <p class="text-base">@flight.MainArrivalAirportCode</p>
                                                            <p class="text-2xl font-bold">@flight.MainArrivalTime</p>
                                                        </div>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <div class="flex items-center">
                                                            <img src="~/Content/img/flight-list/item-flight-list/bag1.svg" alt="" />
                                                            <p class="text-xs">@clTicketDefault.RecommendationNumber</p>
                                                        </div>
                                                        <div class="flex items-center">
                                                            <img src="~/Content/img/flight-list/item-flight-list/bag2.svg" alt="" />
                                                            <p class="text-xs">@clTicketDefault.AllowanceBaggage</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-span-3 max-lg:col-span-2 content-price">
                                                <div class="flex gap-4 justify-end items-center cursor-pointer select-none detail ">
                                                    <div class="p-2 border border-bg-info rounded-lg">
                                                        <p class="text-xs">Từ</p>
                                                        <p class="min-w-[127px] text-end text-[22px] text-accent leading-5.5 price" data-price-base-adt="@clTicketDefault.FareBaseAdt" data-base-full-adt="@clTicketDefault.TotallPriceAdt" data-price-full-pax="@totalPriceOrderDf">
                                                            <span class="font-bold price">@firstPart_pf</span> <br />@last3_pf VNĐ
                                                        </p>
                                                        <p class="text-end text-sm">Giá 01 người lớn</p>
                                                        <p class="text-end font-bold text-xs">Chọn giá ></p>
                                                    </div>
                                                    <div class="min-w-[127px] p-2 border border-highlight rounded-lg max-lg:hidden">
                                                        <p class="text-xs">Đến</p>
                                                        <p class="text-end text-[22px] text-accent leading-5.5 price-end" data-price-base-adt="@clTicketEnd.FareBaseAdt" data-base-full-adt="@clTicketEnd.TotallPriceAdt" data-price-full-pax="@totalPriceOrderEd">
                                                            <span class="font-bold">@firstPart_pe</span> <br />@last3_pe VNĐ
                                                        </p>
                                                        <p class="text-end text-sm">Giá 01 người lớn</p>
                                                        <p class="text-end font-bold text-xs">Chọn giá ></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="hidden relative list-card-price bg-bg-info rounded-xl p-5 flex justify-between items-center overflow-hidden">
                                            <div class="pre absolute left-4 top-1/2 -translate-y-1/2 cursor-pointer z-1">
                                                <button class="bg-primary text-white rounded-xl p-3 opacity-60 cursor-pointer">&lt;</button>
                                            </div>
                                            <div class="next absolute right-4 top-1/2 -translate-y-1/2 cursor-pointer z-1">
                                                <button class="bg-primary text-white rounded-xl p-3 opacity-60 cursor-pointer">&gt;</button>
                                            </div>
                                            @foreach (var price in flight.PriceBreakDowns)
                                            {
                                                decimal totalPriceOrder = (price.TotallPriceAdt * numAdt) + (price.TotallPriceChd * numChd) + (price.TotallPriceInf * numInf);
                                                <div class="card-price max-w-1/4 min-w-1/4  p-5  rounded-xl  shadow-[0_8px_20px_rgba(0,0,0,0.1)] bg-white max-lg:max-w-1/3 max-lg:min-w-1/3 max-md:max-w-1/2 max-md:min-w-1/2 max-sm:max-w-full max-sm:min-w-full">
                                                    <div class="flex flex-col gap-4 items-center">
                                                        <p class="text-xs font-bold">@price.ClassName</p>
                                                        <div>
                                                            <p class="text-accent text-base text-center font-bold">@ProtechGroup.Application.Common.CoreUtils.FormatPrice(totalPriceOrder) VND</p>
                                                            <p class="text-[#B3B0D8] text-xs">Giá vé cho @totalPax hành khách</p>
                                                        </div>
                                                        <div>
                                                            <button class="bg-accent text-sm py-1 px-5 text-white rounded-2xl select-flight"
                                                                    data-codeairline="@flight.MainAirlineCode" data-session="@searchInput.SessionId" data-keybooking="@price.BookingKey" data-way="InBound" data-total-price="@totalPriceOrder">
                                                                Chọn vé
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="info mt-5">
                                                        <ul class="border-b border-gray-300 border-dotted pb-4 mb-4">
                                                            <li class="flex gap-2 items-center">
                                                                <img src="~/Content/img/flight-list/item-flight-list/bag1.svg" alt="" />
                                                                <p class="text-xs">@price.RecommendationNumber</p>
                                                            </li>
                                                            <li class="flex gap-2 items-center">
                                                                <img src="~/Content/img/flight-list/item-flight-list/bag2.svg" alt="" />
                                                                <p class="text-xs">@price.AllowanceBaggage</p>
                                                            </li>
                                                        </ul>
                                                        <ul class="border-b border-gray-300 border-dotted pb-4 mb-4">
                                                            <li class="flex gap-2 items-center">
                                                                <img src="~/Content/img/flight-info/ticket.svg" alt="" style="width:24px; height:24px;" />
                                                                <p class="text-xs">@price.ReturnTicket</p>
                                                            </li>

                                                        </ul>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
</section>
<script src="~/Scripts/modules/resultFlightDomestic.js"></script>
<script>
    function changeSelectedFlight(w) {
        let contenFlight;
        if (w == 0)
            contenFlight = document.querySelectorAll('.list-ticket-items-out .plane-items');
        else
            contenFlight = document.querySelectorAll('.list-ticket-items-out .plane-items');
        contenFlight.forEach(item => {
            item.style.display = 'block';
        });
    }
</script>
